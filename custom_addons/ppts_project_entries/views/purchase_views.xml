<?xml version="1.0" encoding="utf-8"?>
<odoo>

	<!-- Sequences for purchase.order -->
	<record id="seq_purchase_order_new" model="ir.sequence">
		<field name="name">Purchase Order</field>
		<field name="code">purchase.order.new</field>
		<field name="prefix">BC/%(y)s/%(woy)s/</field>
		<field name="padding">4</field>
		<field name="company_id" eval="False"/>
	</record>


	<record id="purchase_order_form_inherited" model="ir.ui.view">
		<field name="name">purchase.order.form</field>
		<field name="model">purchase.order</field>
		<field name="inherit_id" ref="purchase.purchase_order_form"/>
		<field name="arch" type="xml">
			<xpath expr="//div[@name='button_box']" position="inside">
				<button type="object" name="action_create_project_entry"
						class="oe_stat_button"
						icon="fa-plus-square" attrs="{'invisible':['|','|','|',('is_project', '=', True),('state', 'not in', ('draft','sent')),('is_internal_purchase' , '!=' , False)]}" groups='ppts_project_entries.group_project_entries_user'>Create
					Affaire
				</button>
				<button type="object" name="action_view_project_entry"
						class="oe_stat_button"
						icon="fa-newspaper-o" attrs="{'invisible':['|', '|', '|', ('is_project', '!=', True), ('state', 'not in', ('draft','sent','to_approve','purchase')),('is_internal_purchase' , '!=' , False)]}"
						groups='ppts_project_entries.group_project_entries_user'>View Affaire
				</button>
			</xpath>
			<xpath expr="//field[@name='partner_ref']" position="after">
				<field name="is_internal_purchase" attrs="{'readonly':[('state', 'not in', ('draft','sent'))]}"/>

				<field name="account_analytic_id" context="{'default_partner_id': partner_id}" groups="analytic.group_analytic_accounting" domain="['|', ('company_id', '=', False), ('company_id', '=', company_id)]" attrs="{'invisible' : [('is_internal_purchase', '=', True)],'required' : [('is_internal_purchase', '=', False),('state', '=', 'draft')],'readonly' : [('state', '!=', 'draft')]}"/>

				<field name="include_logistics" />
				<field name="is_project" invisible="1"/>
				<field name="is_sorted" invisible="1"/>
			</xpath>
			<xpath expr="//field[@name='company_id']" position="after">
				<field name="pricing_type"/>
				<!-- <field name="is_fifteen_days" attrs="{'invisible':[('pricing_type', '!=', 'variable')]}"/>
				<field name="is_analysis" attrs="{'invisible':[('pricing_type', '!=', 'variable')]}"/> -->
				<field name="project_entry_id"/>
			</xpath>
			<xpath expr="//button[@id='draft_confirm']" position="replace">
				<button name="button_confirm" type="object" string="Confirm Order" id="draft_confirm" attrs="{'invisible':['|',('state' , 'not in' , 'draft'),('is_internal_purchase', '=', False)]}"/>
			</xpath>
			<xpath expr="//button[@id='bid_confirm']" position="replace">
				<button name="button_confirm" type="object" string="Confirm Order" class="oe_highlight" id="bid_confirm" attrs="{'invisible':['|',('state' , 'not in' , 'sent'),('is_internal_purchase', '=', False)]}"/>
			</xpath>
			<xpath expr="//button[@name='button_cancel']" position="before">
				<button name="update_po_price" type="object" string="Update Price" class="oe_highlight" attrs="{'invisible':[('state' , 'not in' , 'purchase')]}"/>
			</xpath>
			<xpath expr="//button[@name='button_cancel']" position="before">
				<button name="action_send_mask_rfq" type="object" string="Send Detailed PO" class="oe_highlight" attrs="{'invisible':[('state' , 'not in' , 'purchase')]}"/>
			</xpath>

			<xpath expr="//button[@name='button_cancel']" position="after">
				<button name="action_export_mask_po" type="object" string="Export Mask PO Report" class="oe_highlight" attrs="{'invisible' : [('is_sorted', '!=', True)]}"/>
				<!-- attrs="{'invisible' : [('is_sorted', '!=', True)]}" -->
			</xpath>

			<xpath expr="//field[@name='order_line']" position='attributes'>
                <attribute name="attrs">{'readonly': [('is_internal_purchase', '=', False)]}</attribute>
			</xpath>

			<xpath expr="//field[@name='order_line']//tree//field[@name='account_analytic_id']" position='attributes'>
                <attribute name="optional">show</attribute>
				<attribute name="attrs">{'required': [('parent.is_internal_purchase', '=', True),('display_type', '=', False)]}</attribute>
				<attribute name="force_save">1</attribute>
			</xpath>

			<xpath expr="//notebook" position='inside'>
				<page string="Fraction Report" attrs="{'invisible' : [('is_sorted', '!=', True)]}">
					<field name="mask_po_line_ids" widget="section_and_note_one2many">
						<tree editable="bottom" >
							<control>
								<create name="add_product_control" string="Add a line"/>

								<!-- <create name="add_section_control" string="Add a section" context="{'default_display_type': 'line_section'}"/> -->
								
								<create name="add_note_control" string="Add a note" context="{'default_display_type': 'line_note'}"/>
							</control>
							<field name="sequence" widget="handle" />
							<field name="display_type" invisible="1"/>
							
							<field name="product_id" attrs="{
                                          'required': [('display_type', '=', False)],
                                      }"/>

							<field name="name" string="Description" widget="section_and_note_text"/>

							<!-- <field name="update_name_field" invisible="1"/> -->
							<field name="description" invisible="1"/>
							<field name="product_qty" />
							<field name="product_uom" />
							<field name="price_unit" />
							<field name="taxes_id" widget="many2many_tags" options="{'no_create_edit': True}"/>
							<field name="price_subtotal" />
						</tree>
					</field>
					<group class="oe_subtotal_footer oe_right">
	                    <field name="mask_po_total" widget="monetary" options="{'currency_field': 'currency_id'}"/>
	                    <field name="mask_po_total" class="oe_subtotal_footer_separator" widget="monetary" options="{'currency_field': 'currency_id'}"/>
	                </group>
				</page>
			</xpath>
		</field>
	</record>


	<record id="mask_po_line_tree" model="ir.ui.view">
		<field name="name">mask.po.line.tree</field>
		<field name="model">mask.po.line</field>
		<field name="arch" type="xml">
			<tree string="Mask Po Line">
				<field name='sequence'/>
				<field name='product_id'/>
				<field name='description'/>
				<field name='product_qty'/>
				<field name='product_uom'/>
				<field name="price_unit"/>
				<field name='taxes_id'/>
				<field name='price_subtotal' />
				<field name='display_type'/>
				<!-- <field name='update_name_field'/> -->
			</tree>
		</field>
	</record>


	<record id="action_mask_po_report" model="ir.actions.act_window">
		<field name="name">Mask Po Line</field>
		<field name="res_model">mask.po.line</field>
		<field name="view_mode">tree</field>
	</record>


	<menuitem name="Mask Po Report" id="menu_mask_po_report" parent="menu_project_custom" action="ppts_project_entries.action_mask_po_report" sequence="3" active="false"/>

</odoo>